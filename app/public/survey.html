<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=100, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Game Roster - Team Finder</title>

     <!-- Bootsrap CSS, AJAX, & jQuery CDN Links -->
     <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
 
     <!-- CSS & Font Files --> 
     <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
     <link rel="icon" href="./assets/images/Sigma.png">
     <link type="text/css" rel="stylesheet" href="./assets/css/style.css">


</head>
<body>
    <!-- Splash Area -->
    <div class="row jumbotron text-center" id="survey-splash">
        <div class="col-12" id="survey-splash-text">
        <h1>Find Your Perfect Team</h1>
        <h3>Answer The Questions Below To Get Started</h3>
        </div>
    </div> 

    <!-- Form Start -->
    <form>
        <div class="form-row justify-content-around">
            <div class="form-group col-md-5 col-12">
                <label for="">What Time Zone Do You Play In?</label>
                <select class="form-control" id="q1">
                    <option data="1">Eastern Time</option>
                    <option data="2">Central Time</option>
                    <option data="3">Mountain Time</option>
                    <option data="4">Pacific Time</option>
                    <option data="5">I'm Not In The United States</option>
                </select>
            </div>
            <div class="form-group col-md-5 col-12">
                <label for="">What Age Range Do You Like To Play With?</label>
                <select class="form-control" id="q2">
                    <option data="1">13 to 18 Years Old</option>
                    <option data="2">19 to 25 Years Old</option>
                    <option data="3">26 to 35 Years Old</option>
                    <option data="4">36 to 45 Years Old</option>
                    <option data="5">Over 45 Years Old</option>
                </select>
            </div>
        </div>
        <div class="form-row justify-content-around">
            <div class="form-group col-md-5 col-12">
                <label for="">How Competitive Is Your Game Play?</label>
                <select class="form-control" id="q3">
                    <option data="1">All Casual</option>
                    <option data="2">Mostly Casual Games</option>
                    <option data="3">Some Competitive & Some Casual</option>
                    <option data="4">Mostly Competitive</option>
                    <option data="5">Hard Core Competitive</option>
                </select>
            </div>
            <div class="form-group col-md-5 col-12">
                <label for="">What Types Of Games Do You Play?</label>
                <select class="form-control" id="q4">
                    <option data="1">All PVP</option>
                    <option data="2">Mostly PVP</option>
                    <option data="3">Some PVP & Some PVE</op>
                    <option data="4">Mostly PVE</option>
                    <option data="5">All PVE</option>
                </select>
            </div>
        </div>
        <div class="form-row justify-content-around">
            <div class="form-group col-md-5 col-12">
                <label for="">What Times Do You Mostly Play At?</label>
                <select class="form-control" id="q5">
                    <option data="1">Early Mornings</option>
                    <option data="2">Mid-Day</option>
                    <option data="3">Afternoons</option>
                    <option data="4">Evenings</option>
                    <option data="5">Late Night</option>
                </select>
            </div>
            <div class="form-group col-md-5 col-12">
                <label for="">What Days Do You Mostly Play?</label>
                <select class="form-control" id="q6">
                    <option data="1">I Rarely Play</option>
                    <option data="2">Weekdays Mostly</option>
                    <option data="3">I Play On Random Days</option>
                    <option data="4">Weekends Mostly</option>
                    <option data="5">I Play Every Day</option>
                </select>
            </div>
        </div>
        <div class="form-row justify-content-around">
            <div class="form-group col-md-5 col-12">
                <label for="">Do You Play In Tournaments?</label>
                <select class="form-control" id="q7">
                    <option data="1">Never</option>
                    <option data="2">Rarely</option>
                    <option data="3">Sometimes</option>
                    <option data="4">Often</option>
                    <option data="5">I'm A Pro</option>
                </select>
            </div>
            <div class="form-group col-md-5 col-12">
                <label for="">What Is Your Favorite Genre Of Games?</label>
                <select class="form-control" id="q8">
                    <option data="1">FPS</option>
                    <option data="2">Sports</option>
                    <option data="3">Fighting</option>
                    <option data="4">RPG</option>
                    <option data="5">Strategy</option>
                </select>
            </div>
        </div>
        <div class="form-row justify-content-around">
            <div class="form-group col-md-5 col-12">
                <label for="">What Is Your Ideal Clan Size?</label>
                <select class="form-control" id="q9">
                    <option data="1">Small Group</option>
                    <option data="2">Mid-Sized Group</option>
                    <option data="3">Large Group</option>
                    <option data="4">Massive Group</option>
                    <option data="5">I Don't Care</option>
                </select>
            </div>
            <div class="form-group col-md-5 col-12">
                <label for="">What Is Your Top Interest?</label>
                <select class="form-control" id="q10">
                    <option data="1">Competitive Gaming</option>
                    <option data="2">Charities</option>
                    <option data="3">College Groups</option>
                    <option data="4">Streaming</option>
                    <option data="5">None Of These</option>
                </select>
            </div>
        </div>
        <div class="row justify-content-around pt-4" id="survey-submit-div">
            <button type="submit" class="btn col-md-4 col-12" id="survey-submit">Submit</button>
        </div>
    </form>


    <!--Footer Section-->
    <footer>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12 pt-4 pb-3 text-center">
                    <p><strong>Â© Copyright 2018 Tony Wible</strong></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <div class="modal fade" id="teamModal" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">We Found Your Match</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img class="col-12 img img-fluid" id="best-team-img" src="https://gameroster.com/assets/clans/jumbo/25-7085552fdd36d2fadfe8c087c77f2e2b.png">
                    <h2 class="col-12 text-center" id="best-team-name">Placeholder</h2>
                    <p class="col-12 text-center">Thank you for checking out the Game Roster Team Finder prototype. Click the button below if you want to see something like this in action on the live GameRoster.com site. Simply, click the "Filter" button when you get there.</p>
                <div class="modal-footer">
                </div>                
                    <button type="button" class="btn btn-block" data-dismiss="modal">Take Me To GameRoster.com</button>
                    <button type="button" class="btn btn-block" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap, Firebase, Moment.JS, & JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>  

    <script type="text/javascript">
        // Grab Survey Responses With Loop
        $("#survey-submit").on("click", function(event) {
          event.preventDefault();
            
            var userScores=[];
            var teamTotalsArray =[];
            
            // Function For Adding Scores
            function add(a,b){
                return parseInt(a) + parseInt(b);
            }
            
            // Grab User Data From Survey
            // Use find() To Pull Data From Selected Dropdown 
            for(var i=1; i < 11; i++){
                var score = $("#q"+ String(i)).find(':selected').attr("data");
                userScores.push(score);
            };

            
            // Package Up User Answers For Post
            var postScores = {
                scores: userScores
            };

            // Store User Scores
            $.post("/api/user/scores", postScores).then(function(data) {
                console.log("Data Stored: ", data);
            });
            
            // Calculate The User Total Score
            var userTotal = userScores.reduce(add, 0);

            // Get Team Data
            $.get("/api/teams", function(data){
                var teamArray = data;

                // Store Variables For Calculations
                // 50 Is Max Score So Start With That For Lowest Difference   
                var difference=0;
                var lowestDifference=50;
                var bestTeam=[0];

                // Loop To Add Scores & Compare Each To User On Absolute Value Basis
                for(var i=0; i < teamArray.length; i++){
                    var teamTotal = teamArray[i].scores.reduce(add, 0);
                    difference = Math.abs(parseInt(teamTotal) - parseInt(userTotal));
                    if(difference < lowestDifference){
                        lowestDifference = difference;
                        bestTeam[0] = teamArray[i];
                    } 
                }

                // Add Data To Modal & Display Modal
                $("#best-team-img").attr("src", bestTeam[0].image);
                $("#best-team-name").text(bestTeam[0].name);    
                $("#teamModal").modal('show');
             
            });
        });
      </script>


</body>
</html>